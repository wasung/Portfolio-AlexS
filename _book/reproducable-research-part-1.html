<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Reproducable research part 1 | Portfolio DSFB</title>
  <meta name="description" content="6 Reproducable research part 1 | Portfolio DSFB" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Reproducable research part 1 | Portfolio DSFB" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Reproducable research part 1 | Portfolio DSFB" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="c.elegans-plate-experiment.html"/>
<link rel="next" href="relational-databases.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.1</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="curriculum-vitae-wing-kien-alex-sung.html"><a href="curriculum-vitae-wing-kien-alex-sung.html"><i class="fa fa-check"></i><b>2</b> Curriculum Vitae Wing-kien Alex Sung</a>
<ul>
<li class="chapter" data-level="" data-path="curriculum-vitae-wing-kien-alex-sung.html"><a href="curriculum-vitae-wing-kien-alex-sung.html#education"><i class="fa fa-check"></i>Education</a></li>
<li class="chapter" data-level="" data-path="curriculum-vitae-wing-kien-alex-sung.html"><a href="curriculum-vitae-wing-kien-alex-sung.html#work-experience"><i class="fa fa-check"></i>Work Experience</a></li>
<li class="chapter" data-level="" data-path="curriculum-vitae-wing-kien-alex-sung.html"><a href="curriculum-vitae-wing-kien-alex-sung.html#activities"><i class="fa fa-check"></i>Activities</a></li>
<li class="chapter" data-level="" data-path="curriculum-vitae-wing-kien-alex-sung.html"><a href="curriculum-vitae-wing-kien-alex-sung.html#additional-skills"><i class="fa fa-check"></i>Additional Skills</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="looking-ahead.html"><a href="looking-ahead.html"><i class="fa fa-check"></i><b>3</b> Looking Ahead</a>
<ul>
<li class="chapter" data-level="" data-path="looking-ahead.html"><a href="looking-ahead.html#professional-development"><i class="fa fa-check"></i>Professional Development</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="guerilla-analytics.html"><a href="guerilla-analytics.html"><i class="fa fa-check"></i><b>4</b> Guerilla Analytics</a></li>
<li class="chapter" data-level="5" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html"><i class="fa fa-check"></i><b>5</b> C.elegans Plate Experiment</a>
<ul>
<li class="chapter" data-level="5.1" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#exploring-the-excel-dataset-structure"><i class="fa fa-check"></i><b>5.1</b> Exploring the Excel Dataset Structure</a></li>
<li class="chapter" data-level="5.2" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#importing-the-dataset-into-r"><i class="fa fa-check"></i><b>5.2</b> Importing the Dataset into R</a></li>
<li class="chapter" data-level="5.3" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#checking-and-correcting-data-types"><i class="fa fa-check"></i><b>5.3</b> Checking and Correcting Data Types</a></li>
<li class="chapter" data-level="5.4" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#visualizing-raw-data-scatterplot"><i class="fa fa-check"></i><b>5.4</b> Visualizing Raw Data: Scatterplot</a></li>
<li class="chapter" data-level="5.5" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#fixing-axis-label-issues-in-ggplot"><i class="fa fa-check"></i><b>5.5</b> Fixing Axis Label Issues in ggplot</a></li>
<li class="chapter" data-level="5.6" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#identifying-positive-controls"><i class="fa fa-check"></i><b>5.6</b> Identifying Positive Controls</a></li>
<li class="chapter" data-level="5.7" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#identifying-negative-controls"><i class="fa fa-check"></i><b>5.7</b> Identifying Negative Controls</a></li>
<li class="chapter" data-level="5.8" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#designing-a-statistical-analysis-strategy"><i class="fa fa-check"></i><b>5.8</b> Designing a Statistical Analysis Strategy</a></li>
<li class="chapter" data-level="5.9" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#normalizing-data-using-the-control-group"><i class="fa fa-check"></i><b>5.9</b> Normalizing Data Using the Control Group</a></li>
<li class="chapter" data-level="5.10" data-path="c.elegans-plate-experiment.html"><a href="c.elegans-plate-experiment.html#why-normalize"><i class="fa fa-check"></i><b>5.10</b> Why Normalize?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html"><i class="fa fa-check"></i><b>6</b> Reproducable research part 1</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#heterologous-prime-boost-immunisation-with-mrna--and-adc68-based-2019-ncov-variant-vaccines-induces-broad-spectrum-immune-responses-in-mice"><i class="fa fa-check"></i><b>6.1</b> Heterologous prime-boost immunisation with mRNA- and AdC68-based 2019-nCoV variant vaccines induces broad-spectrum immune responses in mice</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#study-purpose"><i class="fa fa-check"></i><b>6.1.1</b> Study purpose</a></li>
<li class="chapter" data-level="6.1.2" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#study-location"><i class="fa fa-check"></i><b>6.1.2</b> Study location</a></li>
<li class="chapter" data-level="6.1.3" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#ethics-statement"><i class="fa fa-check"></i><b>6.1.3</b> Ethics statement</a></li>
<li class="chapter" data-level="6.1.4" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#funding-statement"><i class="fa fa-check"></i><b>6.1.4</b> Funding statement</a></li>
<li class="chapter" data-level="6.1.5" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#data-availability-statement-and-location"><i class="fa fa-check"></i><b>6.1.5</b> Data availability statement and location</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="reproducable-research-part-1.html"><a href="reproducable-research-part-1.html#estimating-the-effects-of-non-pharmaceutical-interventions-on-covid-19-in-europe"><i class="fa fa-check"></i><b>6.2</b> Estimating the effects of non-pharmaceutical interventions on COVID-19 in Europe</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="relational-databases.html"><a href="relational-databases.html"><i class="fa fa-check"></i><b>7</b> Relational databases</a></li>
<li class="chapter" data-level="8" data-path="creating-r-package.html"><a href="creating-r-package.html"><i class="fa fa-check"></i><b>8</b> Creating R package</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Portfolio DSFB</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reproducable-research-part-1" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Reproducable research part 1<a href="reproducable-research-part-1.html#reproducable-research-part-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="heterologous-prime-boost-immunisation-with-mrna--and-adc68-based-2019-ncov-variant-vaccines-induces-broad-spectrum-immune-responses-in-mice" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Heterologous prime-boost immunisation with mRNA- and AdC68-based 2019-nCoV variant vaccines induces broad-spectrum immune responses in mice<a href="reproducable-research-part-1.html#heterologous-prime-boost-immunisation-with-mrna--and-adc68-based-2019-ncov-variant-vaccines-induces-broad-spectrum-immune-responses-in-mice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Xingxing Li, Jingjing Liu, Wenjuan Li, Qinhua Peng, Miao Li, Zhifang Ying, Zelun Zhang, Xinyu Liu, Xiaohong Wu, Danhua Zhao, Lihong Yang, Shouchun Cao, Yanqiu Huang, Leitai Shi, Hongshan Xu, Yunpeng Wang, Guangzhi Yue, Yue Suo, Jianhui Nie, Weijin Huang, Jia Li, * and Yuhua Li.</p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10050358/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10050358/</a> (add reference later)</p>
<div id="study-purpose" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Study purpose<a href="reproducable-research-part-1.html#study-purpose" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There was no concise statement in the introduction of the article, that established the reason the research was conducted.</p>
</div>
<div id="study-location" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Study location<a href="reproducable-research-part-1.html#study-location" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The study location has been mentioned in the methods, it was conducted at National institute for food and drug control (NIFDC).</p>
</div>
<div id="ethics-statement" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Ethics statement<a href="reproducable-research-part-1.html#ethics-statement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There is a small ethics statement on handling of the animals and a small section on conflict of interest, this states there have been no conflicts with any other party.</p>
</div>
<div id="funding-statement" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Funding statement<a href="reproducable-research-part-1.html#funding-statement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There is no section on fundings, however there is a section on acknowledgements. Here 2 companies are acknowledged for the provision of vaccines, it is rather unclear if these were provided for free or bought.</p>
</div>
<div id="data-availability-statement-and-location" class="section level3 hasAnchor" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Data availability statement and location<a href="reproducable-research-part-1.html#data-availability-statement-and-location" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There is a small section where supplementary materials can be accessed. THere is a download link to the ‘data sheet’. The sheet is a word doc with the processed data in figures in a doc file. Access to raw data would be better to have. It does however mention that you can inquire for more data but it requires you to contact the authors but, there is no author contact info available. Furthermore no code was used for this research.</p>
<p>#Reproducable research part 2</p>
</div>
</div>
<div id="estimating-the-effects-of-non-pharmaceutical-interventions-on-covid-19-in-europe" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Estimating the effects of non-pharmaceutical interventions on COVID-19 in Europe<a href="reproducable-research-part-1.html#estimating-the-effects-of-non-pharmaceutical-interventions-on-covid-19-in-europe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(<a href="https://www.nature.com/articles/s41586-020-2405-7" class="uri">https://www.nature.com/articles/s41586-020-2405-7</a>)
The paper has R code shared in the project environment and has clear instructions how to reproduce the data from the paper.
(Describe the code:)
The script runs smoohtly after installing all packages. I got the code from : <a href="https://github.com/ImperialCollegeLondon/covid19model.git" class="uri">https://github.com/ImperialCollegeLondon/covid19model.git</a></p>
<p>It clearly states version 7 was used for the Nature paper so I used that one. For this base-nature.r script was used.
On a scale from 1-5 I would rate this paper a 5 in how easy it was to reproduce. I could import the all the scripts from their github and rerun their data through the scripts the used.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="reproducable-research-part-1.html#cb13-1" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb13-2"><a href="reproducable-research-part-1.html#cb13-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb13-3"><a href="reproducable-research-part-1.html#cb13-3" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb13-4"><a href="reproducable-research-part-1.html#cb13-4" tabindex="-1"></a><span class="fu">library</span>(gdata)</span>
<span id="cb13-5"><a href="reproducable-research-part-1.html#cb13-5" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-6"><a href="reproducable-research-part-1.html#cb13-6" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb13-7"><a href="reproducable-research-part-1.html#cb13-7" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb13-8"><a href="reproducable-research-part-1.html#cb13-8" tabindex="-1"></a><span class="fu">library</span>(optparse)</span>
<span id="cb13-9"><a href="reproducable-research-part-1.html#cb13-9" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb13-10"><a href="reproducable-research-part-1.html#cb13-10" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb13-11"><a href="reproducable-research-part-1.html#cb13-11" tabindex="-1"></a><span class="fu">library</span>(matrixStats)</span>
<span id="cb13-12"><a href="reproducable-research-part-1.html#cb13-12" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb13-13"><a href="reproducable-research-part-1.html#cb13-13" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb13-14"><a href="reproducable-research-part-1.html#cb13-14" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb13-15"><a href="reproducable-research-part-1.html#cb13-15" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb13-16"><a href="reproducable-research-part-1.html#cb13-16" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-17"><a href="reproducable-research-part-1.html#cb13-17" tabindex="-1"></a><span class="fu">library</span>(abind)</span>
<span id="cb13-18"><a href="reproducable-research-part-1.html#cb13-18" tabindex="-1"></a></span>
<span id="cb13-19"><a href="reproducable-research-part-1.html#cb13-19" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;nature/utils/process-covariates.r&#39;</span>)</span>
<span id="cb13-20"><a href="reproducable-research-part-1.html#cb13-20" tabindex="-1"></a></span>
<span id="cb13-21"><a href="reproducable-research-part-1.html#cb13-21" tabindex="-1"></a><span class="co"># Commandline options and parsing</span></span>
<span id="cb13-22"><a href="reproducable-research-part-1.html#cb13-22" tabindex="-1"></a>parser <span class="ot">&lt;-</span> <span class="fu">OptionParser</span>()</span>
<span id="cb13-23"><a href="reproducable-research-part-1.html#cb13-23" tabindex="-1"></a>parser <span class="ot">&lt;-</span> <span class="fu">add_option</span>(parser, <span class="fu">c</span>(<span class="st">&quot;-D&quot;</span>, <span class="st">&quot;--debug&quot;</span>), <span class="at">action=</span><span class="st">&quot;store_true&quot;</span>,</span>
<span id="cb13-24"><a href="reproducable-research-part-1.html#cb13-24" tabindex="-1"></a>                     <span class="at">help=</span><span class="st">&quot;Perform a debug run of the model&quot;</span>)</span>
<span id="cb13-25"><a href="reproducable-research-part-1.html#cb13-25" tabindex="-1"></a>parser <span class="ot">&lt;-</span> <span class="fu">add_option</span>(parser, <span class="fu">c</span>(<span class="st">&quot;-F&quot;</span>, <span class="st">&quot;--full&quot;</span>), <span class="at">action=</span><span class="st">&quot;store_true&quot;</span>,</span>
<span id="cb13-26"><a href="reproducable-research-part-1.html#cb13-26" tabindex="-1"></a>                     <span class="at">help=</span><span class="st">&quot;Perform a full run of the model&quot;</span>)</span>
<span id="cb13-27"><a href="reproducable-research-part-1.html#cb13-27" tabindex="-1"></a>cmdoptions <span class="ot">&lt;-</span> <span class="fu">parse_args</span>(parser, <span class="at">args =</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly =</span> <span class="cn">TRUE</span>), <span class="at">positional_arguments =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-28"><a href="reproducable-research-part-1.html#cb13-28" tabindex="-1"></a></span>
<span id="cb13-29"><a href="reproducable-research-part-1.html#cb13-29" tabindex="-1"></a><span class="co"># Default run parameters for the model</span></span>
<span id="cb13-30"><a href="reproducable-research-part-1.html#cb13-30" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(cmdoptions<span class="sc">$</span>options<span class="sc">$</span>debug)) {</span>
<span id="cb13-31"><a href="reproducable-research-part-1.html#cb13-31" tabindex="-1"></a>  DEBUG <span class="ot">=</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;DEBUG&quot;</span>) <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span></span>
<span id="cb13-32"><a href="reproducable-research-part-1.html#cb13-32" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-33"><a href="reproducable-research-part-1.html#cb13-33" tabindex="-1"></a>  DEBUG <span class="ot">=</span> cmdoptions<span class="sc">$</span>options<span class="sc">$</span>debug</span>
<span id="cb13-34"><a href="reproducable-research-part-1.html#cb13-34" tabindex="-1"></a>}</span>
<span id="cb13-35"><a href="reproducable-research-part-1.html#cb13-35" tabindex="-1"></a></span>
<span id="cb13-36"><a href="reproducable-research-part-1.html#cb13-36" tabindex="-1"></a><span class="co"># Sys.setenv(FULL = &quot;TRUE&quot;)</span></span>
<span id="cb13-37"><a href="reproducable-research-part-1.html#cb13-37" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(cmdoptions<span class="sc">$</span>options<span class="sc">$</span>full)) {</span>
<span id="cb13-38"><a href="reproducable-research-part-1.html#cb13-38" tabindex="-1"></a>  FULL <span class="ot">=</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;FULL&quot;</span>) <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span></span>
<span id="cb13-39"><a href="reproducable-research-part-1.html#cb13-39" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-40"><a href="reproducable-research-part-1.html#cb13-40" tabindex="-1"></a>  FULL <span class="ot">=</span> cmdoptions<span class="sc">$</span>options<span class="sc">$</span>full</span>
<span id="cb13-41"><a href="reproducable-research-part-1.html#cb13-41" tabindex="-1"></a>}</span>
<span id="cb13-42"><a href="reproducable-research-part-1.html#cb13-42" tabindex="-1"></a></span>
<span id="cb13-43"><a href="reproducable-research-part-1.html#cb13-43" tabindex="-1"></a><span class="cf">if</span>(DEBUG <span class="sc">&amp;&amp;</span> FULL) {</span>
<span id="cb13-44"><a href="reproducable-research-part-1.html#cb13-44" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Setting both debug and full run modes at once is invalid&quot;</span>)</span>
<span id="cb13-45"><a href="reproducable-research-part-1.html#cb13-45" tabindex="-1"></a>}</span>
<span id="cb13-46"><a href="reproducable-research-part-1.html#cb13-46" tabindex="-1"></a></span>
<span id="cb13-47"><a href="reproducable-research-part-1.html#cb13-47" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(cmdoptions<span class="sc">$</span>args) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb13-48"><a href="reproducable-research-part-1.html#cb13-48" tabindex="-1"></a>  StanModel <span class="ot">=</span> <span class="st">&#39;base-nature&#39;</span></span>
<span id="cb13-49"><a href="reproducable-research-part-1.html#cb13-49" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-50"><a href="reproducable-research-part-1.html#cb13-50" tabindex="-1"></a>  StanModel <span class="ot">=</span> cmdoptions<span class="sc">$</span>args[<span class="dv">1</span>]</span>
<span id="cb13-51"><a href="reproducable-research-part-1.html#cb13-51" tabindex="-1"></a>}</span>
<span id="cb13-52"><a href="reproducable-research-part-1.html#cb13-52" tabindex="-1"></a></span>
<span id="cb13-53"><a href="reproducable-research-part-1.html#cb13-53" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Running %s&quot;</span>,StanModel))</span>
<span id="cb13-54"><a href="reproducable-research-part-1.html#cb13-54" tabindex="-1"></a><span class="cf">if</span>(DEBUG) {</span>
<span id="cb13-55"><a href="reproducable-research-part-1.html#cb13-55" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Running in DEBUG mode&quot;</span>)</span>
<span id="cb13-56"><a href="reproducable-research-part-1.html#cb13-56" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (FULL) {</span>
<span id="cb13-57"><a href="reproducable-research-part-1.html#cb13-57" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Running in FULL mode&quot;</span>)</span>
<span id="cb13-58"><a href="reproducable-research-part-1.html#cb13-58" tabindex="-1"></a>}</span>
<span id="cb13-59"><a href="reproducable-research-part-1.html#cb13-59" tabindex="-1"></a></span>
<span id="cb13-60"><a href="reproducable-research-part-1.html#cb13-60" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Running:</span><span class="sc">\n</span><span class="st">StanModel = %s</span><span class="sc">\n</span><span class="st">Debug: %s</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb13-61"><a href="reproducable-research-part-1.html#cb13-61" tabindex="-1"></a>            StanModel,DEBUG))</span>
<span id="cb13-62"><a href="reproducable-research-part-1.html#cb13-62" tabindex="-1"></a></span>
<span id="cb13-63"><a href="reproducable-research-part-1.html#cb13-63" tabindex="-1"></a><span class="co"># Read which countires to use</span></span>
<span id="cb13-64"><a href="reproducable-research-part-1.html#cb13-64" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;nature/data/regions.rds&#39;</span>)</span>
<span id="cb13-65"><a href="reproducable-research-part-1.html#cb13-65" tabindex="-1"></a><span class="co"># Read deaths data for regions</span></span>
<span id="cb13-66"><a href="reproducable-research-part-1.html#cb13-66" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;nature/data/COVID-19-up-to-date.rds&#39;</span>)</span>
<span id="cb13-67"><a href="reproducable-research-part-1.html#cb13-67" tabindex="-1"></a><span class="co"># Read IFR and pop by country</span></span>
<span id="cb13-68"><a href="reproducable-research-part-1.html#cb13-68" tabindex="-1"></a>ifr.by.country <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;nature/data/popt-ifr.rds&#39;</span>)</span>
<span id="cb13-69"><a href="reproducable-research-part-1.html#cb13-69" tabindex="-1"></a></span>
<span id="cb13-70"><a href="reproducable-research-part-1.html#cb13-70" tabindex="-1"></a><span class="co"># Read interventions</span></span>
<span id="cb13-71"><a href="reproducable-research-part-1.html#cb13-71" tabindex="-1"></a>interventions <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;nature/data/interventions.rds&#39;</span>)</span>
<span id="cb13-72"><a href="reproducable-research-part-1.html#cb13-72" tabindex="-1"></a></span>
<span id="cb13-73"><a href="reproducable-research-part-1.html#cb13-73" tabindex="-1"></a>forecast <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># increase to get correct number of days to simulate</span></span>
<span id="cb13-74"><a href="reproducable-research-part-1.html#cb13-74" tabindex="-1"></a><span class="co"># Maximum number of days to simulate</span></span>
<span id="cb13-75"><a href="reproducable-research-part-1.html#cb13-75" tabindex="-1"></a>N2 <span class="ot">&lt;-</span> (<span class="fu">max</span>(d<span class="sc">$</span>DateRep) <span class="sc">-</span> <span class="fu">min</span>(d<span class="sc">$</span>DateRep) <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> forecast)[[<span class="dv">1</span>]]</span>
<span id="cb13-76"><a href="reproducable-research-part-1.html#cb13-76" tabindex="-1"></a></span>
<span id="cb13-77"><a href="reproducable-research-part-1.html#cb13-77" tabindex="-1"></a>processed_data <span class="ot">&lt;-</span> <span class="fu">process_covariates</span>(<span class="at">countries =</span> countries, <span class="at">interventions =</span> interventions, </span>
<span id="cb13-78"><a href="reproducable-research-part-1.html#cb13-78" tabindex="-1"></a>                                     <span class="at">d =</span> d , <span class="at">ifr.by.country =</span> ifr.by.country, <span class="at">N2 =</span> N2)</span>
<span id="cb13-79"><a href="reproducable-research-part-1.html#cb13-79" tabindex="-1"></a></span>
<span id="cb13-80"><a href="reproducable-research-part-1.html#cb13-80" tabindex="-1"></a>stan_data <span class="ot">=</span> processed_data<span class="sc">$</span>stan_data</span>
<span id="cb13-81"><a href="reproducable-research-part-1.html#cb13-81" tabindex="-1"></a>dates <span class="ot">=</span> processed_data<span class="sc">$</span>dates</span>
<span id="cb13-82"><a href="reproducable-research-part-1.html#cb13-82" tabindex="-1"></a>deaths_by_country <span class="ot">=</span> processed_data<span class="sc">$</span>deaths_by_country</span>
<span id="cb13-83"><a href="reproducable-research-part-1.html#cb13-83" tabindex="-1"></a>reported_cases <span class="ot">=</span> processed_data<span class="sc">$</span>reported_cases</span>
<span id="cb13-84"><a href="reproducable-research-part-1.html#cb13-84" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb13-85"><a href="reproducable-research-part-1.html#cb13-85" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-86"><a href="reproducable-research-part-1.html#cb13-86" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">stan_model</span>(<span class="fu">paste0</span>(<span class="st">&#39;nature/stan-models/&#39;</span>,StanModel,<span class="st">&#39;.stan&#39;</span>))</span>
<span id="cb13-87"><a href="reproducable-research-part-1.html#cb13-87" tabindex="-1"></a></span>
<span id="cb13-88"><a href="reproducable-research-part-1.html#cb13-88" tabindex="-1"></a><span class="cf">if</span>(DEBUG) {</span>
<span id="cb13-89"><a href="reproducable-research-part-1.html#cb13-89" tabindex="-1"></a>  fit <span class="ot">=</span> <span class="fu">sampling</span>(m,<span class="at">data=</span>stan_data,<span class="at">iter=</span><span class="dv">40</span>,<span class="at">warmup=</span><span class="dv">20</span>,<span class="at">chains=</span><span class="dv">2</span>)</span>
<span id="cb13-90"><a href="reproducable-research-part-1.html#cb13-90" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (FULL) {</span>
<span id="cb13-91"><a href="reproducable-research-part-1.html#cb13-91" tabindex="-1"></a>  fit <span class="ot">=</span> <span class="fu">sampling</span>(m,<span class="at">data=</span>stan_data,<span class="at">iter=</span><span class="dv">1800</span>,<span class="at">warmup=</span><span class="dv">1000</span>,<span class="at">chains=</span><span class="dv">5</span>,<span class="at">thin=</span><span class="dv">1</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99</span>, <span class="at">max_treedepth =</span> <span class="dv">20</span>))</span>
<span id="cb13-92"><a href="reproducable-research-part-1.html#cb13-92" tabindex="-1"></a>} <span class="cf">else</span> { </span>
<span id="cb13-93"><a href="reproducable-research-part-1.html#cb13-93" tabindex="-1"></a>  fit <span class="ot">=</span> <span class="fu">sampling</span>(m,<span class="at">data=</span>stan_data,<span class="at">iter=</span><span class="dv">600</span>,<span class="at">warmup=</span><span class="dv">300</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">thin=</span><span class="dv">1</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>, <span class="at">max_treedepth =</span> <span class="dv">10</span>))</span>
<span id="cb13-94"><a href="reproducable-research-part-1.html#cb13-94" tabindex="-1"></a>}   </span>
<span id="cb13-95"><a href="reproducable-research-part-1.html#cb13-95" tabindex="-1"></a></span>
<span id="cb13-96"><a href="reproducable-research-part-1.html#cb13-96" tabindex="-1"></a>out <span class="ot">=</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit)</span>
<span id="cb13-97"><a href="reproducable-research-part-1.html#cb13-97" tabindex="-1"></a>prediction <span class="ot">=</span> out<span class="sc">$</span>prediction</span>
<span id="cb13-98"><a href="reproducable-research-part-1.html#cb13-98" tabindex="-1"></a>estimated.deaths <span class="ot">=</span> out<span class="sc">$</span>E_deaths</span>
<span id="cb13-99"><a href="reproducable-research-part-1.html#cb13-99" tabindex="-1"></a>estimated.deaths.cf <span class="ot">=</span> out<span class="sc">$</span>E_deaths0</span>
<span id="cb13-100"><a href="reproducable-research-part-1.html#cb13-100" tabindex="-1"></a></span>
<span id="cb13-101"><a href="reproducable-research-part-1.html#cb13-101" tabindex="-1"></a>JOBID <span class="ot">=</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;PBS_JOBID&quot;</span>)</span>
<span id="cb13-102"><a href="reproducable-research-part-1.html#cb13-102" tabindex="-1"></a><span class="cf">if</span>(JOBID <span class="sc">==</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb13-103"><a href="reproducable-research-part-1.html#cb13-103" tabindex="-1"></a>  JOBID <span class="ot">=</span> <span class="fu">as.character</span>(<span class="fu">abs</span>(<span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">1000000</span>)))</span>
<span id="cb13-104"><a href="reproducable-research-part-1.html#cb13-104" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Jobid = %s&quot;</span>,JOBID))</span>
<span id="cb13-105"><a href="reproducable-research-part-1.html#cb13-105" tabindex="-1"></a></span>
<span id="cb13-106"><a href="reproducable-research-part-1.html#cb13-106" tabindex="-1"></a>countries <span class="ot">&lt;-</span> countries<span class="sc">$</span>Regions</span>
<span id="cb13-107"><a href="reproducable-research-part-1.html#cb13-107" tabindex="-1"></a><span class="fu">save</span>(fit,prediction,dates,reported_cases,deaths_by_country,countries,estimated.deaths,estimated.deaths.cf,stan_data, <span class="at">file=</span><span class="fu">paste0</span>(<span class="st">&#39;nature/results/&#39;</span>,StanModel,<span class="st">&#39;-&#39;</span>,JOBID,<span class="st">&#39;-stanfit.Rdata&#39;</span>))</span>
<span id="cb13-108"><a href="reproducable-research-part-1.html#cb13-108" tabindex="-1"></a></span>
<span id="cb13-109"><a href="reproducable-research-part-1.html#cb13-109" tabindex="-1"></a></span>
<span id="cb13-110"><a href="reproducable-research-part-1.html#cb13-110" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb13-111"><a href="reproducable-research-part-1.html#cb13-111" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(StanModel,<span class="st">&#39;-&#39;</span>,JOBID)</span>
<span id="cb13-112"><a href="reproducable-research-part-1.html#cb13-112" tabindex="-1"></a></span>
<span id="cb13-113"><a href="reproducable-research-part-1.html#cb13-113" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Generating mu, rt plots&#39;</span>)</span>
<span id="cb13-114"><a href="reproducable-research-part-1.html#cb13-114" tabindex="-1"></a>mu <span class="ot">=</span> (<span class="fu">as.matrix</span>(out<span class="sc">$</span>mu))</span>
<span id="cb13-115"><a href="reproducable-research-part-1.html#cb13-115" tabindex="-1"></a><span class="fu">colnames</span>(mu) <span class="ot">=</span> countries</span>
<span id="cb13-116"><a href="reproducable-research-part-1.html#cb13-116" tabindex="-1"></a>g <span class="ot">=</span> (<span class="fu">mcmc_intervals</span>(mu,<span class="at">prob =</span> .<span class="dv">9</span>))</span>
<span id="cb13-117"><a href="reproducable-research-part-1.html#cb13-117" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">sprintf</span>(<span class="st">&quot;nature/figures/%s-mu.png&quot;</span>,filename),g,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height=</span><span class="dv">6</span>)</span>
<span id="cb13-118"><a href="reproducable-research-part-1.html#cb13-118" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(countries), <span class="cf">function</span>(i) (out<span class="sc">$</span>Rt_adj[,stan_data<span class="sc">$</span>N[i],i]))</span>
<span id="cb13-119"><a href="reproducable-research-part-1.html#cb13-119" tabindex="-1"></a>Rt_adj <span class="ot">=</span> <span class="fu">do.call</span>(cbind,tmp)</span>
<span id="cb13-120"><a href="reproducable-research-part-1.html#cb13-120" tabindex="-1"></a><span class="fu">colnames</span>(Rt_adj) <span class="ot">=</span> countries</span>
<span id="cb13-121"><a href="reproducable-research-part-1.html#cb13-121" tabindex="-1"></a>g <span class="ot">=</span> (<span class="fu">mcmc_intervals</span>(Rt_adj,<span class="at">prob =</span> .<span class="dv">9</span>))</span>
<span id="cb13-122"><a href="reproducable-research-part-1.html#cb13-122" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">sprintf</span>(<span class="st">&quot;nature/figures/%s-final-rt.png&quot;</span>,filename),g,<span class="at">width=</span><span class="dv">4</span>,<span class="at">height=</span><span class="dv">6</span>)</span>
<span id="cb13-123"><a href="reproducable-research-part-1.html#cb13-123" tabindex="-1"></a></span>
<span id="cb13-124"><a href="reproducable-research-part-1.html#cb13-124" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Generate 3-panel plots&quot;</span>)</span>
<span id="cb13-125"><a href="reproducable-research-part-1.html#cb13-125" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;nature/utils/plot-3-panel.r&#39;</span>)</span>
<span id="cb13-126"><a href="reproducable-research-part-1.html#cb13-126" tabindex="-1"></a><span class="fu">make_three_panel_plot</span>(filename)</span>
<span id="cb13-127"><a href="reproducable-research-part-1.html#cb13-127" tabindex="-1"></a></span>
<span id="cb13-128"><a href="reproducable-research-part-1.html#cb13-128" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Covars plots&#39;</span>)</span>
<span id="cb13-129"><a href="reproducable-research-part-1.html#cb13-129" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;nature/utils/covariate-size-effects.r&#39;</span>)</span>
<span id="cb13-130"><a href="reproducable-research-part-1.html#cb13-130" tabindex="-1"></a><span class="fu">plot_covars</span>(filename)</span>
<span id="cb13-131"><a href="reproducable-research-part-1.html#cb13-131" tabindex="-1"></a></span>
<span id="cb13-132"><a href="reproducable-research-part-1.html#cb13-132" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Making table&#39;</span>)</span>
<span id="cb13-133"><a href="reproducable-research-part-1.html#cb13-133" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;nature/utils/make-table.r&#39;</span>)</span>
<span id="cb13-134"><a href="reproducable-research-part-1.html#cb13-134" tabindex="-1"></a><span class="fu">make_table</span>(filename)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="c.elegans-plate-experiment.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="relational-databases.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
